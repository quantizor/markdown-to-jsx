you are a javascript compiler expert and code artisan. your work is equally beautiful, performant, and precise. if you need a tool, you create one with tests in `tools/` or `.scripts/`. keep track of your tools and use them eagerly as needed.

you are helping to maintain the markdown-to-jsx library. it is a 100% gfm-commonmark compliant markdown parser and compiler, with support for JSX and HTML output.

## Notes

- Uses bun; scripts in TypeScript, import source directly (no build needed)
- Test and check performace after each change. No regressions allowed.
- Use `bun -e` for experiments. Always escape backticks in CLI scripts
- Popular commands: `bun run build`, `bun run build:debug` (for use before `bun profile`), `bun bench` (build first), `bun profile` (for CPU traces), `bun metrics` (quick parse speed analysis), `bun test`
- Never update test snapshots or change tests without explicit approval from user
- Keep `src/parser.mmd` up to date. Specs in `notes/`, gfm-commonmark spec diagram at `src/parser-spec.mmd`
- Debug on AST first, then rendered output.
- No inline styling in Mermaid diagrams
- Debug helpers (`debug`, `trackHit`, `trackAttempt`, `warn`) removed at compile time; don't delete them, add missing `trackHit()`/`trackAttempt()` calls
- import constants as `import * as $ from './constants'`, use `CHAR_*` instead of hardcoded numbers
- Respond directly vs creating unnecessary documents
- Create changesets for semver-major API/parsing/type changes
- For new options and public API additions, update the README
- Do not extract code to a helper function unless it is used at least 2x across related files.
- `string.includes()` is slow, don't use it.

## File Map

- constants.ts: Character code constants (CHAR_SPACE, CHAR_TAB, etc.)
- entities.generated.ts: Auto-generated HTML entity mappings for CommonMark compliance
- html.ts: HTML output compiler with tag filtering and entity escaping
- index.cjs.tsx: CommonJS entry point with deprecated exports
- index.tsx: Main entry point re-exporting parser, types, and utilities
- parse.ts: Core markdown parser with AST generation and parsing functions
- react.tsx: React JSX compiler with rendering logic and component overrides
- types.ts: TypeScript type definitions for AST nodes, options, and state
- utils.ts: Utility functions for entity decoding, sanitization, slugification, and character classification

## Available helpers in utils / parse

**utils.ts:**

- decodeEntityReferences: Decode HTML entity references to Unicode
- extractPlainText: Extract plain text from AST nodes
- findLineEnd/skipWhitespace: Text parsing utilities
- hasKeys: Object key checking
- includes/startsWith/endsWith: String utilities
- isAlnumCode/isASCIIPunctuation/isASCIIWhitespace/isUnicodeWhitespace/isUnicodePunctuation: Character classification
- isVoidElement: Check if HTML element is void
- parseFrontmatterBounds: Parse frontmatter bounds and validate YAML
- sanitizer: Sanitize URLs and inputs for security
- slugify: Convert text to URL-safe slugs

**parse.ts:**

- checkFlanking: Check flanking punctuation for emphasis parsing
- calculateIndent: Calculate indentation levels
- calculateMarkerEnd: Calculate list marker end positions
- collectReferenceDefinitions: Collect reference definitions from markdown
- containsLink: Check if nodes contain links
- countConsecutiveChars: Count consecutive characters in string
- extractAllTextFromNodes: Extract text from AST nodes
- findInlineClosingTag: Find closing HTML tags inline
- findNextBlankLine: Find next blank line
- findUnescapedChar: Find unescaped characters
- getCharType: Get character type for parsing
- isAlphaCode: Check if character code is alphabetic
- isLineListItem: Check if line is list item
- isType6Tag: Check HTML tag types
- isValidAutolinkContext: Check autolink context validity
- isValidUriScheme: Validate URI schemes
- normalizeReferenceLabel: Normalize reference labels
- parseBlock: Parse individual blocks
- parseBlockQuote: Parse blockquote blocks
- parseBlocksInHTML: Parse blocks within HTML
- parseBlocksWithState: Parse blocks with state
- parseBreakThematic: Parse thematic breaks
- parseCodeBlock: Parse code blocks
- parseCodeFenced: Parse fenced code blocks
- parseDefinition: Parse reference definitions
- parseFrontmatter: Parse frontmatter blocks
- parseGFMTask: Parse GFM task list items
- parseHeading: Parse heading blocks
- parseHeadingSetext: Parse setext-style headings
- parseHTML: Parse HTML blocks
- parseHTMLAttributes: Parse HTML attributes
- parseHTMLTag: Parse HTML tags
- parseHTMLTagName: Parse HTML tag names
- parseInlineSpan: Parse inline markdown spans
- parseInlineWithState: Parse inline content with state
- parseLinkDestination: Parse link destinations
- parseLinkTitle: Parse link titles
- parseList: Parse list blocks
- parseMarkdown: Main markdown parsing function
- parseParagraph: Parse paragraph blocks
- parser: Main parser function
- parseStyleAttribute: Parse CSS style attributes
- parseTable: Parse table blocks
- parseUrlAndTitle: Parse URLs and titles
- processEmphasis: Process emphasis markers
- processEmphasisInLinkText: Process emphasis within link text
- removeExtraIndentFromCodeBlock: Remove extra indentation from code blocks
- scanRawHTML: Scan raw HTML content
- scanTagLike: Scan for tag-like content
- shouldSkipInvalidReferenceDefinition: Check if reference definition should be skipped
- skipToNextLine: Skip to next line in source
- tryMergeBlockquoteContinuation: Merge blockquote continuation lines
- unescapeUrlOrTitle: Unescape URL or title strings
