Deeply inspect the code the user has indicated. Create separate analysis TODOs for each major function or code branch. After they have been analyzed in their entirety, confer with the user to ask clarifying questions and then consider multiple improvements per area of concern. Use the web search tool to perform research and identify novel approaches that satisfy the code quality rules. Present each of these candidate improvements to the user for approval, then create a comprehensive plan for the final selections. This plan should include the following:

1. Tests for new or uncovered behaviors to ensure no regressions
2. Supporting documentation (diagrams, code snippets, etc) to guide the implementation
3. Key Metrics to validate each change; if there is inadequate instrumentation/tooling to validate improvement, propose new ones or enhancement to existing tools.
